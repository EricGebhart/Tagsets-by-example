\chapter{Using LaTeX}
Besides HTML and XML, LaTeX output is one of the most useful
and versatile output destinations available.  LaTeX is commonly
used in publishing and is capable of creating several viewable
formats, including PDF and Postscript.  LaTeX supports color
and various image formats.
Sadly, this destination is largely overlooked.
This chapter will discuss how to use it to advantage. 

\section{The LaTeX statement}
\index{ODS Statements!Latex}
Latex is one of the special destination names that is 
shorthand for tagsets.latex.  But there are other latex
tagsets.  Color\_latex differs only in the way it invokes the
usepackage statement to include the 'stylesheet' generated by
latex.  Simple\_latex is the most simplistic form of latex which
lends itself to embedding in other LaTeX documents.

The best way to use the latex tagsets is with an external stylesheet.
Using an external stylesheet is the only way to turn color on.  The
stylesheet includes usepackage statements for all the packages needed
to render the latex.  It also defines macros for the styles and formatting.

Another requirements of using latex is that a url without the .sty extension
be specified for the stylesheet.  This is the name that will go in the 
usepackage statement in the preamble of the latex document.
A sample ods latex statement is shown here.

\begin{sfvcode}
        ods latex file="test.tex" stylesheet="test.sty"(url="test");
\end{sfvcode}

\subsection{Color Support}
\index{Latex!Color}
\index{Tagsets!Color\_Latex}
Color LaTeX is really the same as the regular latex tagset.
The only difference is that a flag is set so that colors will
be used.  The entire tagset looks like this.  The change is
the addition of the color option.

\begin{sfvcode}
    define tagset tagsets.colorlatex; 
        parent=tagsets.latex;

        define event stylesheet_link;
            put CR '\usepackage[color]{';
            put URL;
            put '}' CR CR;
        end;

    end;
\end{sfvcode}

A better color latex tagset would work without a stylesheet url
being specified on the ods statement.  This is only possible in
SAS 9.1, but is a perfect example of how useful data step functions
can be.

\begin{sfvcode}
proc template;
    define tagset tagsets.colorlatex; 
        parent=tagsets.latex;

        define event stylesheet_link;
            put CR '\usepackage[color]{';
            put scan(url, 1, '.');
            put '}' CR CR;
        end;

    end;
run;

ods tagsets.colorlatex file="test.tex" stylesheet="test.sty";
proc print data=sashelp.class;run;
ods _all_ close;
\end{sfvcode}

\section{Compiling the LaTeX Output}
There is no browser for LaTeX.  LaTeX must be compiled into the 
document type desired.  Different commands create the various forms
of browseable output.

\subsection{The latex Command}
\index{Latex}
\index{Latex!Compiling}
\index{Latex!DVI}
The latex command compiles LaTeX into dvi format.  There are many
viewers for dvi files.  Dvi is not as nice as postscript or PDF
but does serve as an intermediate format for postscript and other
formats.  DVI also does not do well with color, although the postscript 
generated from it will.  Compiling the the output from the example above 
would require a statement like this.

\begin{sfvcode}
        latex test
\end{sfvcode}

LaTeX will create several files, all of which have different purposes. The
.aux files contain measurement information.  For this reason it is a good 
idea to run the latex command twice.  The second time it will use the information
it gathered the first time.  The result will be better looking output.  The
output file from this command will be test.dvi.

\subsection{The dvips Command}
\index{dvips}
\index{Postscript}
\index{Latex!Postscript}
The dvi2ps command converts dvi files to postscript.  The resulting postscript
often looks better than the dvi output.  Particularly when color
is used.  The following dvips command will print the contents of test.dvi to
your default printer.  The second command will cause the postscript to be
written to a file, test.ps.  There are many more options to dvips, Printer,
papertype, print controls, cropping, copies, to name just a few.

\begin{sfvcode}
        dvips test.dvi
        dvips test.dvi -o test.ps
\end{sfvcode}

\subsection{The pdflatex Command}
\index{pdflatex}
\index{PDF}
\index{Latex!PDF}
The pdflatex command compiles LaTeX code into PDF.  This works very
well and makes beautiful PDF output.  The pdflatex command is used
in place of the regular latex command to create pdf directly from the
original LaTeX output.  Like the latex command, it is a good idea to
run the pdflatex twice so that measurements will be refined and used.
The following command will create a file named test.pdf.

\begin{sfvcode}
        pdflatex test
        pdflatex test
\end{sfvcode}

\section{Integrating LaTeX output into documents}
Aside from creating pdf or postscript reports it is sometimes
desirable to create output that will be used in a larger 
LaTeX document.  A paper or book for example.

\subsection{The easy way}
\index{usepackage}
\index{color LaTeX}
The easiest thing to do is write an external stylesheet, then add
a usepackage statement to your LaTeX document.  All of the SAS specific
needs will be in that one stylesheet file.  This will provide the best
support for color and formatting of the output.  All of the latex macros
defined in that stylesheet are prefixed with 'sas' so the macro names 
should not clash with any latex code you already have.  Using our test
example from above all you need is the following line in your preamble.
You can then include any parts of the ODS generated report in your own
document.

\begin{sfvcode}
   \usepackage[color]{test}
\end{sfvcode}

\subsection{Using NewFile to advantage}
\index{ODS Options!No\_top}
\index{ODS Options!No\_bot}
\index{ODS Options!No\_top\_matter}
\index{ODS Options!No\_bottom\_matter}
\index{ODS Options!Newfile}
The newfile option, along with no\_top and no\_bot can create nicely 
packaged pieces of output that can be directly included into a LaTeX
document.
Frequently, all that is desired is the actual tabular output generated by
ODS.  There are several options that will help narrow the ODS output to
just the parts you need.  First the select and exclude statements can be
used to select only the particular ODS output objects of interest.  Then
the ODS Markup options, newfile, no\_top\_matter  and no\_bottom\_matter can
be used together to create just the tables or graphs, with no surrounding
latex code.  The ods statement to do that will look like this.

\begin{sfvcode}
     ods latex file="test.tex"(notop, nobot)
               stylesheet="test.sty"(url="test")
               newfile=table;
\end{sfvcode}

The result will be a series of numbered files, starting with test.tex.  
All with one table per file.  These files will be much easier to include
into another latex document.  In fact, depending on the occurance of titles
and notes, these files could be left intact and included with latex's 
include statement, like this.  

\begin{sfvcode}
   \include{test}
\end{sfvcode}

\subsection{The simple way}
\index{Tagsets!Simple\_Latex}
A more simplistic method is to use the simple\_latex tagset.  That tagset
requires nothing outside of the most basic LaTeX.  This latex has a much 
simpler table model that uses the tabular package, and does not support color.
In short, this tagset uses only the most basic latex commands to create tables.
This latex tagset does not need a stylesheet so 
including it's output requires no usepackage to be added in the preamble of your
latex document.  

\section{Image Formats and Graph}
\index{Attributes!Image\_formats}
\index{Images!png}
\index{Images!ps}
\index{Images!eps}
Everything would be great if the image formats attribute actually worked. 
But it doesn't.  At least not for graph procedures.  It does work for
statistical graphics though.  The problem for graph procedures is that
no image types other than those valid for HTML are allowed.  That means
that png will work but not postscript.  PdfLateX likes png images, but
latex and dvips do not.  

The fix for this is a simple tagset that converts image file extensions from
.gif to .ps.  Then after the job is done, the images can be replayed to the
postscript device.  The following example does just that.

\begin{fvcode}{latex_image_files}{A fix for \LaTeX and graph}
 proc template;
    define tagset tagsets.mylatex;
       parent = tagsets.latex;

       image_formats = 'ps,psepsf,png,jpeg,gif';

        define event image;
            put '\sasgraph{';
            put BASENAME / if !exists(NOBASE);

            /* convert gif extension to ps.          */
            /* use eps if you use the psepsf driver. */
            put tranwrd(URL, 'gif', 'ps');

            put '}' CR;
        end;
    end;
 run;          

filename junk ".";

ods tagsets.mylatex file="graph.tex";
goptions dev=gif target=ps;

proc gchart data=sashelp.class;
vbar age / pattid=midpoint;
run;
quit;

proc gplot data=sashelp.class;
plot height*weight;
run;
quit;

ods _all_ close;

/*------------------------------------------------eric-*/
/*-- Replay the graphs to generate postscript.       --*/
/*---------------------------------------------16Oct03-*/
goptions dev=ps gsfname=junk;
proc greplay nofs;
   igout work.gseg;
   replay _all_;
run;
quit;
\end{fvcode}


\section{LaTeX in the different versions of SAS}
\subsection{SAS 8.2}
\index{LaTeX!SAS 8.2}
While ODS Markup was experimental in SAS 8.2 it was still a fairly 
stable product.  The biggest exception to that was the LaTeX output.
The Embedded\_stylesheet option was not an available feature in ODS 
Markup at in that release.  An external stylesheet had to be used.  

But when
a stylesheet was specified, a crash occured.  Because of tagsets,
SAS was able to work around this problem by making a new latex
tagset available.  The new tagset was called latex2.  The latex2
tagset solved the problem by writing a fixed set of style definitions
to the preamble of the LaTeX document.  No stylesheet option was needed.
The disadvantage was that the ods markup style option had no effect.
Using this latex in other documents was also very problematic.

\subsection{SAS 9.0}
\index{LaTeX!SAS 9.0}
In SAS 9.0 LaTeX worked much better.  The LaTeX code itself was much
cleaner and more adaptable.  A common complaint was using the output
as inclusions in other documents.  One of the changes was the addition
of the 'sas' prefix on all of the ODS generated latex macros.

\subsection{SAS 9.1 and beyond.}
\index{LaTeX!SAS 9.1}
\index{Measured Output}
\index{Measured Destination}
\index{Tagsets!Measured}
LaTeX has continued to evolve with the addition of the simple Latex
tagset.  The latex output is more versatile than ever.

Another addition in SAS 9.2 is 
measured markup destination.  
The measured markup destination
adds measurement variables to tagsets.
This destination is more or less invisible, since the behavior is
turned on by the tagset's measurement attribute.
This is the same sort of measurement
that the ODS RTF and Printer destinations do.  The first goal of this
destination is support an RTF tagset.  But LaTeX will also benefit from
this.

Turning on measurement will enable the LaTeX tagset to make intelligent 
decisions about table panelling and paging. 

\section{Summary}
\index{PDF}
\index{Postscript}
\index{DVI}
LaTeX is one of the most useful outputs that ODS creates.  It can be
easily be used within Documents of any size from reports and papers to
books.  It can be used to create many output types including PDF, Postscript,
and DVI.



