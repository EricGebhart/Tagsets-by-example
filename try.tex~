\documentclass{book}
\usepackage{fancyvrb}
\usepackage{varioref}

\DefineVerbatimEnvironment{code}{Verbatim}
{commandchars=\\\#\?, tabsize=4, xleftmargin=1cm, 
 samepage=false, hfuzz=1pt, fontsize=\small,
 frame=lines, framesep=3mm}


\DefineVerbatimEnvironment{codel}{Verbatim}
{commandchars=\\\#, tabsize=4, xleftmargin=1cm, 
 samepage=false, hfuzz=1pt, fontsize=\small,
 numbers=left, numbersep=5pt, 
 frame=lines, framesep=3mm}

\newenvironment{myvrb}[2]{\label{#1}
 \Verbatim[commandchars=\\\#, tabsize=4, xleftmargin=1cm, 
 samepage=false, hfuzz=1pt, fontsize=\small,
 frame=lines, framesep=3mm, label={Code \ref{#1}: \itshape{#2}}]}{\endVerbatim}

\newenvironment{fvoutput}[2]{\label{#1}
 \Verbatim[commandchars=\\\#, tabsize=4, xleftmargin=1cm, 
 samepage=false, hfuzz=1pt, fontsize=\small,
 frame=lines, framesep=3mm, label={Output \ref{#1}: \itshape{#2}}]}{\endVerbatim}

\newenvironment{sfvoutput}{
 \Verbatim[commandchars=\\\#, tabsize=4, xleftmargin=1cm, 
 samepage=false, hfuzz=1pt, fontsize=\small,
 frame=lines, framesep=3mm, label={\itshape Output}]}{\endVerbatim}


\begin{document}
\mainmatter

\chapter{test}

\section{something}

\begin{fvoutput}{someoutput}{Some Output}
  This is labeled output
\end{fvoutput}

\begin{sfvoutput}
  This is simple output
\end{sfvoutput}

\begin{myvrb}{somelabel}{Some Caption}
  This is another simple Fancy Verbatim.
\end{myvrb}

\begin{code}[label={\itshape Hello}]
  This is a simple Fancy Verbatim.
\end{code}

\subsection{another}

\begin{codel}[label={\itshape Hello}]
  This is a simple Fancy Verbatim.
\end{codel}

\label{mylabel}
\begin{codel}[label={Code \ref{mylabel} \itshape {My Caption}}]
  this is a test of a new fvcode environment.
  I don't understand why it doesn't work.
\end{codel}

\section{ just something else}
this isn't verbatim text.

\end{document}
